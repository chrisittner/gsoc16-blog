<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="http://chrisittner.github.io/gsoc16-blog/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="http://chrisittner.github.io/gsoc16-blog/theme/stylesheet/pygments.min.css">
  <link rel="stylesheet" type="text/css" href="http://chrisittner.github.io/gsoc16-blog/theme/stylesheet/font-awesome.min.css">


    <link href="http://chrisittner.github.io/gsoc16-blog/feed.rss" type="application/atom+xml" rel="alternate" title="Structure Learning for pgmpy Atom">



  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="index, follow" />

    <meta name="author" content="Chris Ittner" />
    <meta name="description" content="A GSoC blog about Bayesian Network Structure Learning with pgmpy" />
<meta property="og:site_name" content="Structure Learning for pgmpy"/>
<meta property="og:type" content="blog"/>
<meta property="og:title" content="Structure Learning for pgmpy"/>
<meta property="og:description" content="A GSoC blog about Bayesian Network Structure Learning with pgmpy"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="http://chrisittner.github.io/gsoc16-blog"/>
<meta property="og:image" content="http://pgmpy.readthedocs.org/en/latest/_images/logo.png">

  <title>Structure Learning for pgmpy &ndash; GSoC Project Outline</title>

  <style>
    aside nav > ul > li { text-transform: none !important; }
    aside > div > a > img { border-radius:0; }
  </style>
</head>
<body>
  <aside>
    <div>
      <a href="http://chrisittner.github.io/gsoc16-blog">
        <img src="http://pgmpy.readthedocs.org/en/latest/_images/logo.png" alt="Learning BN Structure" title="Learning BN Structure">
      </a>
      <h1><a href="http://chrisittner.github.io/gsoc16-blog">Learning BN Structure</a></h1>
      <p>A GSoC blog for pgmpy</p>
      <nav>
        <ul class="list">
          <li><a href="/">Blog</a></li>
          <li><a href="http://chrisittner.github.io/gsoc16-blog/pages/gsoc-proposal.html#gsoc-proposal">GSoC Project Outline</a></li>
          <li><a href="http://chrisittner.github.io/gsoc16-blog/pages/about-the-project.html#about-the-project">About the Project</a></li>
          <li><a href="http://chrisittner.github.io/gsoc16-blog/pages/about-me.html#about-me">About Me</a></li>
        </ul>
      </nav>
      <ul class="social">
        <li><a class="sc-envelope-o" href="mailto:pgmpy-gsoc@chrisittner.de" target="_blank"><i class="fa fa-envelope-o"></i></a></li>
        <li><a class="sc-rss" href="/feed.rss" target="_blank"><i class="fa fa-rss"></i></a></li>
        <li><a class="sc-github" href="https://github.com/chrisittner" target="_blank"><i class="fa fa-github"></i></a></li>
      </ul>
    </div>
  </aside>
  <main>

<article>
  <header>
    <h1 id="gsoc-proposal">GSoC Project Outline</h1>
  </header>
  <div>
    <p>The following project description is taken from my proposal <em>Structure learning from complete data for pgmpy</em> for Google Summer of Code 2016. The timeline below is preliminary and will be updated as needed. The GSoC work period is May-August.</p>
<h1 id="the-project">The Project</h1>
<p>I will introduce methods to pgmpy to select Bayesian models based on data sets. First, I will implement basic support for score-based and constraint-based structure learning. Second, I will add common enhancements to the score-based approach, including local score computation + memoization and tabu lists. Finally, I will implement the MMHC algorithm, which combines the score-based and the constraint-based method.</p>
<h2 id="motivation">Motivation</h2>
<p>By now, pgmpy supports most of the fundamental operations on probabilistic graphical models (PGMs). Given a data set and a suitable Bayesian network model, pgmpy can parametrize the model based on the data and perform the usual array of inference and sampling tasks. But the model itself must still be supplied manually.</p>
<p>Selecting appropriate models is a major challenge in the application of graphical models. Manual construction of e.g. Bayesian networks is error-prone and infeasible for large models. “Does variable X <em>directly</em> influence Y, or might they have a common cause?” Questions like these should be answered based on data, where possible.</p>
<p>Algorithmic structure learning is an essential feature for any PGM library. In addition, here are two reasons why pgmpy in particular should seek to support structure learning now:</p>
<ul>
<li>Structure learning is currently the missing piece for the full PGM data analysis toolchain in pgmpy. Once this feature is implemented, pgmpy can be used for inference and sampling tasks, starting from a data set alone. This will be helpful to convince new users to work with pgmpy. It aids to open pgmpy to a wider audience of data scientists that are not familiar with the internals of causal modeling.</li>
<li>Structure learning is a recent topic of interest in PGM research. pgmpy has an easily extensible code structure and (aims to have) pythonic implementations. These features make pgmpy a valuable tool to both, researchers and students, who want to experiment with (modified) PGM algorithms. <a href="http://www.amazon.com/Mastering-Probabilistic-Graphical-Models-Python/dp/1784394688">This</a> book is a recent example of the educational nature of the library. pgmpy should not miss its chance to grow as an instructive resource and should seek to cover trending topics such as structure learning as soon as possible.</li>
</ul>
<h2 id="scope">Scope</h2>
<p>Techniques for structure learning differ for Bayesian networks and Markov networks, and depending on whether or not the data is complete (In the sense that (i) each data sample contains information about exactly the same set of variables and (ii) no relevant variables are hidden). In this project, I will implement structure learning for Bayesian models and complete data.</p>
<p>I will add two model selection techniques to pgmpy: score-based model selection and constraint-based model selection. In addition to these basic approaches, I will implement a combination of the two, the MMHC algorithm proposed in [<a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.106.4729&amp;rep=rep1&amp;type=pdf">Tsamardinos et al.</a>, 2006].</p>
<p>Below, I briefly describe the score-based and constraint-based approach, as well as the MMHC algorithm. I then provide a timeline and implementation plan.</p>
<h4 id="score-based-model-selection">Score-based model selection</h4>
<p>This approach construes model selection as an optimization task. It has two building blocks:</p>
<ul>
<li>A <em>scoring function</em> <span class="math">\(s_D\colon M \to \mathbb R\)</span> that maps models to a numerical score, based on how well they fit to a given data set <span class="math">\(D\)</span>.</li>
<li>A <em>search strategy</em> to traverse the search space of possible models <span class="math">\(M\)</span> and select a model with optimal score.</li>
</ul>
<p>In the case of Bayesian network models, there are two natural candidates for the search space: the set of all Directed Acyclic Graphs (DAGs) or the set of all DAG patterns (I-equivalence classes of DAGs). In order to support search on both, I will add a representation for DAG patterns to pgmpy.</p>
<h5 id="scoring-functions">Scoring functions</h5>
<p>Two common scores to measure the fit between model and data are the <em>Bayesian Dirichlet score</em> and the <em>Bayesian Information Criterion</em> (BIC, also called MDL). I will provide implementations for BDe(u) and K2 (two instances of the Bayesian Dirichlet score), and for the BIC score.</p>
<p>Importantly, these scores <em>decompose</em>, i.e. they can be computed locally for each of the variables, independent of other parts of the network. The score implementation will support memoization, such that local scores are only computed once.</p>
<h5 id="search-strategies">Search strategies</h5>
<p>The search space of DAGs or DAG patterns is super-exponential in the number of variables and the typical scoring functions allow for local maxima. The first property makes exhaustive search intractable for all but very small networks, the second prohibits efficient local optimization algorithms to always find the optimal structure. Thus, all interesting search strategies are heuristic.</p>
<p>I want to implement the following heuristic search strategies:
- Greedy Equivalence Search for DAGs and DAG patterns
- First ascent hill climbing for DAGs (see [PGM09, page 814f]), with enhancements:
  - Use tabu lists to ensure that new structures are explored
  - Use score decomposition effectively</p>
<p>For the sake of completeness, I will also add:
  - Exhaustive search for DAGs and DAG patterns</p>
<h4 id="constraint-based-model-selection">Constraint-based model selection</h4>
<p>A common alternative approach to construct models is the following:
1. Identify independencies in the data set using hypothesis tests
2. Construct DAG (pattern) according to identified independencies</p>
<p>There are polynomial-time algorithms for model construction from a set of independencies (see [<a href="http://www.cs.technion.ac.il/~dang/books/Learning%20Bayesian%20Networks&amp;#40;Neapolitan,%20Richard&amp;#41;.pdf">LBN04</a>, page 550] for pseudocode of the PC algorithm, that was introduced by [<a href="https://mitpress.mit.edu/books/causation-prediction-and-search">Spirtes et al.</a>, 1993]). These algorithms are generally more efficient than score-based methods but only work under the assumption that the set of independencies is <em>faithful</em>, i.e. there exists a DAG that exactly corresponds to it. Spurious dependencies in the data set can cause the reported independencies to violate faithfulness. The faithfulness requirement also makes it difficult to construct a Bayesian network from a manually provided list of independencies, because that list must first be extended to satisfy the faithfulness criterion. This in turn is computationally unfeasible except for small models. I will implement constraint-based model selection using independence tests from <code>scipy.stats</code> and the PC model construction algorithm.</p>
<h4 id="the-mmhc-algorithm">The MMHC algorithm</h4>
<p>The MMHC algorithm combines the constraint-based and score-based method effectively. The authors suggest in [<a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.106.4729&amp;rep=rep1&amp;type=pdf">Tsamardinos et al</a>, 2006] that it performs very well against other state-of-the-art structure finding algorithms. At the same time, it is not too difficult to implement. It has two basic steps:
Learn undirected graph skeleton using independence tests + constraint-based construction procedure
Orient edges using score-based optimization with Bayesian score + modified hill-climbing search
For the implementation, I will follow the pseudo code specification in the paper (Algorithm 1, 2 and 3).</p>
<h1 id="timeline">Timeline</h1>
<p>The GSoC period shall be structured in 6 bi-weekly milestones. I will begin each milestone with a discussion post on the GSoC blog.</p>
<h2 id="milestone-1-scoring-methods">Milestone 1: Scoring methods</h2>
<h4 id="implement-representation-for-dag-patterns-i-equivalence-class-of-dags">Implement representation for DAG patterns (= I-Equivalence class of DAGs)</h4>
<p>Add base class for DAG pattern similar to <code>DirectedGraph</code>, except that some edges are undirected. The implementation might use a networkx <code>MultiDiGraph</code>, with arrows in both directions for undirected edges (then DAG instances are actual subgraphs of the pattern) or an <code>UndirectedGraph</code> + a list of v-structures, depending on which performs better. Add methods to get DAG pattern from <code>DirectedGraph</code> and to construct <code>DirectedGraph</code> from DAG pattern (there is an easy algorithm for that in [<a href="http://www.cs.technion.ac.il/~dang/books/Learning%20Bayesian%20Networks&amp;#40;Neapolitan,%20Richard&amp;#41;.pdf">LBN04</a>, etc.]).</p>
<h4 id="implement-bayesian-score-and-bic-score">Implement Bayesian score and BIC score</h4>
<p>Since there are multiple scoring methods with common structure, they will derive from a common abstract class. The base class takes a data set as a parameter and exposes a score-method. If the score is decomposable, a local_score method is public as well.</p>
<p>The Bayesian score for a model <span class="math">\(m\)</span>, given a data set <span class="math">\(D\)</span> is essentially the (marginal) likelihood <span class="math">\(P(m|D)\)</span>. See [PGM09, sections 18.3.2-18.3.6] or <a href="https://www.cs.helsinki.fi/u/bmmalone/probabilistic-models-spring-2014/ScoringFunctions.pdf">these slides</a> for a derivation of the scores. The implementation will support Bayesian Dirichlet priors, in particular the so-called BDe(u) and K2 score. The K2 score, for example, is given by the following term:</p>
<div class="math">$$score^{K2}_D(m) = \log(P(m)) + \sum_{X\in nodes(m)} local\_score^{K2}_D(X, parents_m(X))$$</div>
<p>where <span class="math">\(P(m)\)</span> is some optional structure prior. <span class="math">\(local\_score^{K2}\)</span> is computed for each node as follows (see [<a href="http://www.ee.bgu.ac.il/~boaz/LernerMalkaAAI2011.pdf">Lerner&amp;Malka</a>, 2011, apply <span class="math">\(\log\)</span> to their equation 3]):</p>
<div class="math">$$local\_score^{K2}_D(X, P_X) = \sum_{j=1}^{q(P_X)} (\log(\frac{(r-1)!}{(N_j+r-1)!}) + \sum_{k=1}^r \log(N_{jk}!))$$</div>
<p>Where <span class="math">\(r\)</span> is the cardinality of the variable <span class="math">\(X\)</span>, <span class="math">\(q(P_X)\)</span> is the product of the cardinalities of the parents of <span class="math">\(X\)</span> (= the possible states of <span class="math">\(P_X\)</span>) and <span class="math">\(N_{jk}\)</span> is the number of times that variable <span class="math">\(X\)</span> is in state <span class="math">\(k\)</span> while parents are in state <span class="math">\(j\)</span> in the data sample. Finally, <span class="math">\(N_j:=\sum_{k=1}^r N_{jk}\)</span>.</p>
<p>The BDe(u) and BIC score can similarly be computed from some closed equation. All methods will be implemented to score both DAGs and DAG patterns.</p>
<h2 id="milestone-2-work-on-estimators-structure-search">Milestone 2: Work on estimators, structure search</h2>
<h4 id="split-estimator-base-classes">Split estimator base classes</h4>
<p>The BaseEstimator class will be split in one <code>ParameterEstimator</code> and one <code>StructureEstimator</code> base class, so that they can each define a common interface for derived classes. <code>ParameterEstimator</code> is initialized with a data set and a model and should minimally expose <code>get_parameters</code> (and maybe <code>get_parameter</code> if the estimator decomposes). A <code>StructureEstimator</code> is initialized with a data set and minimally exposes <code>get_model</code>.</p>
<h4 id="port-bayesianestimator-from-bookv01-branch">Port <code>BayesianEstimator</code> from <code>book/v0.1</code> branch</h4>
<p>Add support for Bayesian parameter estimation. Currently pgmpy has ML parameter estimation, which <a href="https://en.wikipedia.org/wiki/Overfitting">overfits</a> the data. Bayesian estimation is partially implemented in the <code>book/v0.1</code> branch and needs to be reviewed, completed and ported to <code>dev</code> branch. While not directly used in model selection, parameter estimation is needed once a structure is found.</p>
<h4 id="implement-basic-structure-search-strategies-that-optimize-score">Implement basic structure search strategies that optimize score</h4>
<p>Each of the search strategies below will be implemented as a <code>StructureEstimator</code> (parametric on a data set and a score):</p>
<ul>
<li>Exhaustive search</li>
<li>First-ascent hill climbing (HC)<ul>
<li>Start at a given starting DAG</li>
<li>Sample operations from [“add edge”,”remove edge”,”reverse arrow”], evaluate score and modify DAG whenever score increases.</li>
<li>Converges to local maximum</li>
</ul>
</li>
<li>Greedy Equivalence Search (GES) (as described e.g. here)</li>
</ul>
<h2 id="milestone-3-enhanced-score-based-structure-learning">Milestone 3: Enhanced score-based structure learning</h2>
<p>The following enhancements will be implemented to improve performance of both HC and GES.</p>
<h4 id="tabu-lists">Tabu lists</h4>
<p>Tabu search forces the algorithm to explore new structures by preventing the reversal of recent structure changes, e.g. the last 100. [PGM09, page 816] says this already improves performance significantly.</p>
<h4 id="make-sure-score-decomposability-is-used-optimally">Make sure score decomposability is used optimally</h4>
<p>[PGM09, page 818f] suggest that search algorithms could directly operate with “delta scores”, that indicate whether or not a local change increases the overall score. Explore whether this improves performance over regular caching of the score method, using e.g. a memoization decorator.
Optional: Implement data perturbation (or random restarts) to escape local maxima
Data perturbation consists in small random manipulations of the underlying data set to escape local maxima without substantially changing the global structure. I would like to implement some simple mechanisms, as described in [PGM09, page 817].</p>
<h2 id="milestone-4-constraint-based-structure-learning">Milestone 4: Constraint-based structure learning</h2>
<p>Add constraint-based structure learning as a new <code>StructureEstimator</code>:</p>
<h4 id="statistical-independence-tests-on-data-sets">Statistical independence tests on data sets</h4>
<p>Implement method to perform statistical independence tests to query (conditional) independencies from data set. Method is internal to class and will, if possible, rely on e.g. <code>scipy.stats.chi2_contingency</code> rather than implementing the test by hand.</p>
<h4 id="constraint-based-model-construction">Constraint-based model construction</h4>
<p>The PA algorithm [<a href="http://www.cs.technion.ac.il/~dang/books/Learning%20Bayesian%20Networks&amp;#40;Neapolitan,%20Richard&amp;#41;.pdf">LBN04</a>, page 550] constructs DAG patterns from faithful sets of independencies. Implement this algorithm with flexible “source” for independencies:
- A data set -&gt; use independence tests
- A given set of faithful independencies -&gt; directly work with them
- Any set of independencies -&gt; for small models we can compute closure under semi-graphoid rules to obtain faithful set of independencies and continue from there.</p>
<h2 id="milestone-5-mmhc-algorithm">Milestone 5: MMHC algorithm</h2>
<p>Implement the MMHC algorithm as a <code>StructureEstimator</code>. The algorithm is described step-by-step in  [<a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.106.4729&amp;rep=rep1&amp;type=pdf">Tsamardinos et al</a>, 2006], in three parts. It first uses a constraint-based model construction algorithm called MMPC that is faster than the PC procedure above, but only generates a DAG skeleton, i.e. an <code>UndirectedGraph</code>. Then, a modified hill climbing search with tabu list is used with a BDe score to orient the edges of the graph. This algorithm combines several of the previously implemented features.</p>
<h2 id="milestone-6-example-gallery-for-structure-learning-tasks">Milestone 6: Example gallery for structure learning tasks</h2>
<p>Since pgmpy would benefit from some show cases, the final milestone is dedicated to creating some written content and applications.</p>
<h4 id="example-gallery-for-website">Example gallery for website</h4>
<p>Write some guiding introductory examples for structure learning using pgmpy, to illustrate the newly added features. <em>Target audience: new visitors to pgmpy.</em></p>
<h4 id="case-studies-for-structure-learning-tasks">Case studies for structure learning tasks</h4>
<p>Implement &amp; describe non-trivial show cases for structure learning, for example by replicating structure learning studies/papers in pgmpy. <em>Target audience: people interested in structure learning.</em></p>
<h4 id="performance-tests">Performance tests</h4>
<p>Extend <a href="https://github.com/pgmpy/pgmpy-benchmarks">pgmpy-benchmarks</a> to include some performance statistics for the structure learning methods in pgmpy (and potentially other libraries). Performance tests are valuable information for anyone interested in real applications.</p>
<h4 id="structure-learning-tutorial-for-pgmy_notebook">Structure learning tutorial for pgmy_notebook</h4>
<p>Add structure learning tutorial in a new page for the “<a href="https://github.com/pgmpy/pgmpy_notebook">pgmpy_notebook</a>”.</p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    var location_protocol = (false) ? 'https' : document.location.protocol;
    if (location_protocol !== 'http' && location_protocol !== 'https') location_protocol = 'https:';
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = location_protocol + '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
  </div>
</article>

    <footer>
<p>
  &copy; Chris Ittner 2016 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>Built using <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a></p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
         src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>





</body>
</html>